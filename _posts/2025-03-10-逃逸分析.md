---
layout:     post
title:      æ·±å…¥ç†è§£Golangé€ƒé€¸åˆ†æ
subtitle:   ä»LeetCode LRUé¢˜ç›®å¼•å‘çš„æ€è€ƒ ğŸ¤”
date:       2025-03-10
author:     ä»˜ä½³è±ª
header-img: img/post-bg-o.jpg
catalog: true
tags:
    - Golang
    - é€ƒé€¸åˆ†æ
    - æ€§èƒ½ä¼˜åŒ–
    - å†…å­˜ç®¡ç†
---

## ğŸ§© é—®é¢˜çš„èµ·æº

åœ¨åšLeetCodeçš„[146. LRUç¼“å­˜](https://leetcode.cn/problems/lru-cache/description/)è¿™é“é¢˜æ—¶ï¼Œæˆ‘æƒ³è‡ªå·±å®ç°ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ä½†æ˜¯LeetCodeæ¨¡æ¿ä¸­çš„åˆå§‹åŒ–æ–¹å¼å¼•èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼š

```go
func Constructor(capacity int) LRUCache {
    return LRUCache{
        ll : list.New(),
        m : make(map[int]*list.Element),
        capacity: capacity,
    }
}

/**
 * Your LRUCache object will be instantiated and called as such:
 * obj := Constructor(capacity);
 * param_1 := obj.Get(key);
 * obj.Put(key,value);
 */
```

## ğŸ¤” ç–‘é—®

è¿™æ ·ä¸ä¼ æŒ‡é’ˆä¸å°±ç›¸å½“äºä¼ äº†ä¸€ä¸ªå‰¯æœ¬å—ï¼Ÿè¿™æ ·å¯¹åç»­çš„ä¿®æ”¹éš¾é“ä¸æ˜¯åœ¨å‰¯æœ¬ä¸Šè¿›è¡Œçš„ï¼Ÿ

è™½ç„¶`ll`å’Œ`m`æœ¬èº«å°±æ˜¯æŒ‡é’ˆï¼Œå‰¯æœ¬å’ŒåŸå§‹å®ä¾‹æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œä½†æ˜¯`capacity`å¹¶éå…±äº«ã€‚è¿™æ ·çš„ç¼ºç‚¹åœ¨äºï¼š
- æ¯æ¬¡Newä¸€ä¸ªå¯¹è±¡éƒ½è¦æ‹·è´æ•´ä¸ªå¯¹è±¡ï¼Œå ç”¨æ›´å¤šå†…å­˜
- å¦‚æœä¼ æŒ‡é’ˆï¼Œç›´æ¥å¯¹åº•å±‚å®ä¾‹ä¿®æ”¹å°±æ²¡è¿™ä¸ªé—®é¢˜

## ğŸ” é€ƒé€¸åˆ†æå®éªŒ

### åˆ†æå·¥å…·

ä½¿ç”¨Golangçš„é€ƒé€¸åˆ†æå·¥å…·ï¼š
```bash
go build -gcflags="-m" main.go
```

### æƒ…å†µä¸€ï¼šè¿”å›å€¼ç±»å‹ï¼ˆLRUï¼‰

```go
// è¿”å›å€¼ç±»å‹çš„é€ƒé€¸åˆ†æç»“æœ
./main.go:22:21: new(list.List) escapes to heap
./main.go:23:17: make(map[int]*list.Element) escapes to heap
./main.go:28:7: leaking param: this
./main.go:30:12: ... argument does not escape
./main.go:34:2: moved to heap: obj
./main.go:34:15: new(list.List) escapes to heap
./main.go:34:15: make(map[int]*list.Element) escapes to heap
./main.go:35:12: ... argument does not escape
```

**åˆ†æç»“æœï¼š**
- âœ… `ll`å’Œ`m`å‘ç”Ÿé€ƒé€¸æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿”å›çš„æ˜¯å¼•ç”¨
- âš ï¸ `obj`è¢«ç§»åŠ¨åˆ°å †ä¸Šï¼šæ¨æµ‹æ˜¯å› ä¸ºè°ƒç”¨`obj.Put()`è¿™æ ·çš„æ–¹æ³•æ—¶ï¼Œå®é™…ä¼ å…¥çš„æ˜¯`&obj`
- ğŸ§  Golangè®¤ä¸ºobjçš„ç”Ÿå‘½å‘¨æœŸè¶…å‡ºäº†å½“å‰ä½œç”¨åŸŸï¼Œå› æ­¤ç§»åŠ¨åˆ°å †ä¸Š

### æƒ…å†µäºŒï¼šè¿”å›æŒ‡é’ˆç±»å‹ï¼ˆ*LRUï¼‰

```go
// è¿”å›æŒ‡é’ˆç±»å‹çš„é€ƒé€¸åˆ†æç»“æœ
./main.go:21:9: &LRU{...} escapes to heap
./main.go:22:21: new(list.List) escapes to heap
./main.go:23:17: make(map[int]*list.Element) escapes to heap
./main.go:28:7: leaking param: this
./main.go:30:12: ... argument does not escape
./main.go:34:2: moved to heap: obj
./main.go:34:15: &LRU{...} escapes to heap
./main.go:34:15: new(list.List) escapes to heap
./main.go:34:15: make(map[int]*list.Element) escapes to heap
./main.go:35:12: ... argument does not escape
```

**åˆ†æç»“æœï¼š**
- ğŸ“ `&LRU{...}`å‘ç”Ÿé€ƒé€¸ï¼Œå› ä¸ºè¢«å¤–éƒ¨å¼•ç”¨
- ğŸ¯ ç›¸æ¯”å€¼ç±»å‹ï¼ŒæŒ‡é’ˆç±»å‹æ›´åŠ ç›´æ¥æ˜äº†

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### å†…å­˜åˆ†é…æµç¨‹

1. **æ ˆä¸Šåˆ†é…** â†’ **å‡½æ•°è°ƒç”¨æ—¶æ£€æµ‹** â†’ **æ˜¯å¦éœ€è¦é€ƒé€¸ï¼Ÿ**
   - âœ… ä¸éœ€è¦ï¼šç»§ç»­åœ¨æ ˆä¸Šï¼Œå‡½æ•°ç»“æŸæ—¶è‡ªåŠ¨å›æ”¶
   - âŒ éœ€è¦ï¼šç§»åŠ¨åˆ°å †ä¸Šï¼Œç­‰å¾…GCå›æ”¶

2. **é€ƒé€¸è§¦å‘æ¡ä»¶**
   - è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆ
   - å‘é€æŒ‡é’ˆåˆ°channel
   - åœ¨sliceä¸Šå­˜å‚¨æŒ‡é’ˆ
   - æ–¹æ³•è°ƒç”¨æ—¶éœ€è¦è·å–æ¥æ”¶è€…åœ°å€

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### âœ… æœ€ä½³å®è·µ

```go
// æ¨èï¼šè¿”å›æŒ‡é’ˆï¼Œé¿å…ä¸å¿…è¦çš„æ‹·è´
func NewLRUCache(capacity int) *LRUCache {
    return &LRUCache{
        ll:       list.New(),
        m:        make(map[int]*list.Element),
        capacity: capacity,
    }
}

// æ¨èï¼šä½¿ç”¨å€¼æ¥æ”¶è€…å¤„ç†å°å¯¹è±¡
func (c LRUCache) GetCapacity() int {
    return c.capacity
}

// æ¨èï¼šä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…å¤„ç†å¤§å¯¹è±¡æˆ–éœ€è¦ä¿®æ”¹çš„æ–¹æ³•
func (c *LRUCache) Put(key, value int) {
    // ä¿®æ”¹é€»è¾‘
}
```

### âš ï¸ æ³¨æ„äº‹é¡¹

- **å°å¯¹è±¡**ï¼šå€¼ä¼ é€’é€šå¸¸æ›´é«˜æ•ˆï¼ˆé¿å…æŒ‡é’ˆè§£å¼•ç”¨å¼€é”€ï¼‰
- **å¤§å¯¹è±¡**ï¼šæŒ‡é’ˆä¼ é€’é¿å…æ˜‚è´µçš„æ‹·è´æ“ä½œ
- **ä¿®æ”¹éœ€æ±‚**ï¼šå¿…é¡»ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…

## ğŸ¯ æ€»ç»“

é€ƒé€¸åˆ†ææ˜¯Golangç¼–è¯‘å™¨çš„ä¸€ä¸ªé‡è¦ä¼˜åŒ–ç‰¹æ€§ï¼š

- ğŸ” **è‡ªåŠ¨åˆ†æ**ï¼šç¼–è¯‘å™¨è‡ªåŠ¨å†³å®šå˜é‡åˆ†é…åœ¨æ ˆè¿˜æ˜¯å †
- âš¡ **æ€§èƒ½å½±å“**ï¼šæ ˆåˆ†é…æ›´å¿«ï¼Œå †åˆ†é…éœ€è¦GC
- ğŸ› ï¸ **è°ƒè¯•å·¥å…·**ï¼š`-gcflags="-m"`å¸®åŠ©ç†è§£é€ƒé€¸è¡Œä¸º
- ğŸ“ˆ **ä¼˜åŒ–ç­–ç•¥**ï¼šæ ¹æ®å¯¹è±¡å¤§å°å’Œä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„ä¼ é€’æ–¹å¼

> ç†è§£é€ƒé€¸åˆ†ææœ‰åŠ©äºç¼–å†™æ›´é«˜æ€§èƒ½çš„Goä»£ç ï¼ ğŸš€

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Goé€ƒé€¸åˆ†æå®˜æ–¹æ–‡æ¡£](https://golang.org/doc/faq#stack_or_heap)
- [Golangå†…å­˜ç®¡ç†æ·±åº¦è§£æ](https://blog.golang.org/ismmkeynote)
